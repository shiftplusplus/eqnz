<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Night Tremors: There are more earthquakes at night</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="The sun’s daily cycle + gravity = earthquakes">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="Night Tremors: There are more earthquakes at night" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The sun’s daily cycle + gravity = earthquakes" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Night Tremors: There are more earthquakes at night" />
  
  <meta name="twitter:description" content="The sun’s daily cycle + gravity = earthquakes" />
  

<meta name="author" content="David Hood">


<meta name="date" content="2017-05-02">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="it-is-not-the-moon.html">
<link rel="next" href="japanese-earthquakes-are-the-same.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Night Tremors</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Front Matter</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#intended-audiences"><i class="fa fa-check"></i><b>0.1</b> Intended Audiences</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>0.2</b> Acknowledgements</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#cover-picture"><i class="fa fa-check"></i><b>0.3</b> Cover Picture</a></li>
<li class="chapter" data-level="0.4" data-path="index.html"><a href="index.html#edition"><i class="fa fa-check"></i><b>0.4</b> Edition</a></li>
<li class="chapter" data-level="0.5" data-path="index.html"><a href="index.html#statistics"><i class="fa fa-check"></i><b>0.5</b> Statistics</a></li>
<li class="chapter" data-level="0.6" data-path="index.html"><a href="index.html#using-r"><i class="fa fa-check"></i><b>0.6</b> Using R</a></li>
<li class="chapter" data-level="0.7" data-path="index.html"><a href="index.html#contacting-me"><i class="fa fa-check"></i><b>0.7</b> Contacting me</a></li>
<li class="chapter" data-level="0.8" data-path="index.html"><a href="index.html#Links0"><i class="fa fa-check"></i><b>0.8</b> Links</a></li>
<li class="chapter" data-level="0.9" data-path="index.html"><a href="index.html#chapter-code"><i class="fa fa-check"></i><b>0.9</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="motivation.html"><a href="motivation.html"><i class="fa fa-check"></i><b>1</b> Motivation</a><ul>
<li class="chapter" data-level="1.1" data-path="motivation.html"><a href="motivation.html#formal-statement"><i class="fa fa-check"></i><b>1.1</b> Formal Statement</a></li>
<li class="chapter" data-level="1.2" data-path="motivation.html"><a href="motivation.html#Links1"><i class="fa fa-check"></i><b>1.2</b> Links</a></li>
<li class="chapter" data-level="1.3" data-path="motivation.html"><a href="motivation.html#code"><i class="fa fa-check"></i><b>1.3</b> Code</a></li>
<li class="chapter" data-level="1.4" data-path="motivation.html"><a href="motivation.html#chapter-code-1"><i class="fa fa-check"></i><b>1.4</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-processing.html"><a href="data-processing.html"><i class="fa fa-check"></i><b>2</b> Data Processing</a><ul>
<li class="chapter" data-level="2.1" data-path="data-processing.html"><a href="data-processing.html#event-types"><i class="fa fa-check"></i><b>2.1</b> Event types</a><ul>
<li class="chapter" data-level="2.1.1" data-path="data-processing.html"><a href="data-processing.html#latitude-and-longitude"><i class="fa fa-check"></i><b>2.1.1</b> Latitude and Longitude</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-processing.html"><a href="data-processing.html#gridded-latitude-and-longitude"><i class="fa fa-check"></i><b>2.2</b> Gridded Latitude and Longitude</a></li>
<li class="chapter" data-level="2.3" data-path="data-processing.html"><a href="data-processing.html#angle-of-the-sun"><i class="fa fa-check"></i><b>2.3</b> Angle of the sun</a></li>
<li class="chapter" data-level="2.4" data-path="data-processing.html"><a href="data-processing.html#formal-statement-1"><i class="fa fa-check"></i><b>2.4</b> Formal statement</a></li>
<li class="chapter" data-level="2.5" data-path="data-processing.html"><a href="data-processing.html#code-1"><i class="fa fa-check"></i><b>2.5</b> Code</a></li>
<li class="chapter" data-level="2.6" data-path="data-processing.html"><a href="data-processing.html#chapter-code-2"><i class="fa fa-check"></i><b>2.6</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="key-result.html"><a href="key-result.html"><i class="fa fa-check"></i><b>3</b> Key result</a><ul>
<li class="chapter" data-level="3.1" data-path="key-result.html"><a href="key-result.html#formal-statement-2"><i class="fa fa-check"></i><b>3.1</b> Formal Statement</a></li>
<li class="chapter" data-level="3.2" data-path="key-result.html"><a href="key-result.html#chapter-code-3"><i class="fa fa-check"></i><b>3.2</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="it-is-not-dependence.html"><a href="it-is-not-dependence.html"><i class="fa fa-check"></i><b>4</b> It is not dependence</a><ul>
<li class="chapter" data-level="4.1" data-path="it-is-not-dependence.html"><a href="it-is-not-dependence.html#formal-statement-3"><i class="fa fa-check"></i><b>4.1</b> Formal Statement</a></li>
<li class="chapter" data-level="4.2" data-path="it-is-not-dependence.html"><a href="it-is-not-dependence.html#chapter-code-4"><i class="fa fa-check"></i><b>4.2</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="it-is-not-masking.html"><a href="it-is-not-masking.html"><i class="fa fa-check"></i><b>5</b> It is not masking</a><ul>
<li class="chapter" data-level="5.1" data-path="it-is-not-masking.html"><a href="it-is-not-masking.html#formal-statement-4"><i class="fa fa-check"></i><b>5.1</b> Formal Statement</a></li>
<li class="chapter" data-level="5.2" data-path="it-is-not-masking.html"><a href="it-is-not-masking.html#links"><i class="fa fa-check"></i><b>5.2</b> Links</a></li>
<li class="chapter" data-level="5.3" data-path="it-is-not-masking.html"><a href="it-is-not-masking.html#chapter-code-5"><i class="fa fa-check"></i><b>5.3</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="it-is-not-seasonal.html"><a href="it-is-not-seasonal.html"><i class="fa fa-check"></i><b>6</b> It is not seasonal</a><ul>
<li class="chapter" data-level="6.1" data-path="it-is-not-seasonal.html"><a href="it-is-not-seasonal.html#formal-statement-5"><i class="fa fa-check"></i><b>6.1</b> Formal statement</a></li>
<li class="chapter" data-level="6.2" data-path="it-is-not-seasonal.html"><a href="it-is-not-seasonal.html#chapter-code-6"><i class="fa fa-check"></i><b>6.2</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="it-is-not-the-moon.html"><a href="it-is-not-the-moon.html"><i class="fa fa-check"></i><b>7</b> It is not the moon</a><ul>
<li class="chapter" data-level="7.1" data-path="it-is-not-the-moon.html"><a href="it-is-not-the-moon.html#absolute-difference"><i class="fa fa-check"></i><b>7.1</b> Absolute difference</a></li>
<li class="chapter" data-level="7.2" data-path="it-is-not-the-moon.html"><a href="it-is-not-the-moon.html#relative"><i class="fa fa-check"></i><b>7.2</b> Relative</a></li>
<li class="chapter" data-level="7.3" data-path="it-is-not-the-moon.html"><a href="it-is-not-the-moon.html#formal-statement-6"><i class="fa fa-check"></i><b>7.3</b> Formal Statement</a></li>
<li class="chapter" data-level="7.4" data-path="it-is-not-the-moon.html"><a href="it-is-not-the-moon.html#links-1"><i class="fa fa-check"></i><b>7.4</b> Links</a></li>
<li class="chapter" data-level="7.5" data-path="it-is-not-the-moon.html"><a href="it-is-not-the-moon.html#chapter-code-7"><i class="fa fa-check"></i><b>7.5</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="it-is-not-uniform.html"><a href="it-is-not-uniform.html"><i class="fa fa-check"></i><b>8</b> It is not uniform</a><ul>
<li class="chapter" data-level="8.1" data-path="it-is-not-uniform.html"><a href="it-is-not-uniform.html#formal-statement-7"><i class="fa fa-check"></i><b>8.1</b> Formal Statement</a></li>
<li class="chapter" data-level="8.2" data-path="it-is-not-uniform.html"><a href="it-is-not-uniform.html#chapter-code-8"><i class="fa fa-check"></i><b>8.2</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="japanese-earthquakes-are-the-same.html"><a href="japanese-earthquakes-are-the-same.html"><i class="fa fa-check"></i><b>9</b> Japanese earthquakes are the same</a><ul>
<li class="chapter" data-level="9.1" data-path="japanese-earthquakes-are-the-same.html"><a href="japanese-earthquakes-are-the-same.html#formal-statement-8"><i class="fa fa-check"></i><b>9.1</b> Formal Statement</a></li>
<li class="chapter" data-level="9.2" data-path="japanese-earthquakes-are-the-same.html"><a href="japanese-earthquakes-are-the-same.html#Links9"><i class="fa fa-check"></i><b>9.2</b> Links</a></li>
<li class="chapter" data-level="9.3" data-path="japanese-earthquakes-are-the-same.html"><a href="japanese-earthquakes-are-the-same.html#chapter-code-9"><i class="fa fa-check"></i><b>9.3</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="the-continental-united-states-is-similar.html"><a href="the-continental-united-states-is-similar.html"><i class="fa fa-check"></i><b>10</b> The continental United States is similar</a><ul>
<li class="chapter" data-level="10.1" data-path="the-continental-united-states-is-similar.html"><a href="the-continental-united-states-is-similar.html#formal-statement-9"><i class="fa fa-check"></i><b>10.1</b> Formal Statement</a></li>
<li class="chapter" data-level="10.2" data-path="the-continental-united-states-is-similar.html"><a href="the-continental-united-states-is-similar.html#Links10"><i class="fa fa-check"></i><b>10.2</b> Links</a></li>
<li class="chapter" data-level="10.3" data-path="the-continental-united-states-is-similar.html"><a href="the-continental-united-states-is-similar.html#chapter-code-10"><i class="fa fa-check"></i><b>10.3</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="italian-earthquakes-are-the-same.html"><a href="italian-earthquakes-are-the-same.html"><i class="fa fa-check"></i><b>11</b> Italian earthquakes are the same</a><ul>
<li class="chapter" data-level="11.1" data-path="italian-earthquakes-are-the-same.html"><a href="italian-earthquakes-are-the-same.html#formal-statement-10"><i class="fa fa-check"></i><b>11.1</b> Formal Statement</a></li>
<li class="chapter" data-level="11.2" data-path="italian-earthquakes-are-the-same.html"><a href="italian-earthquakes-are-the-same.html#Links11"><i class="fa fa-check"></i><b>11.2</b> Links</a></li>
<li class="chapter" data-level="11.3" data-path="italian-earthquakes-are-the-same.html"><a href="italian-earthquakes-are-the-same.html#chapter-code-11"><i class="fa fa-check"></i><b>11.3</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="hawaii-is-similar.html"><a href="hawaii-is-similar.html"><i class="fa fa-check"></i><b>12</b> Hawaii is similar</a><ul>
<li class="chapter" data-level="12.1" data-path="hawaii-is-similar.html"><a href="hawaii-is-similar.html#formal-statement-11"><i class="fa fa-check"></i><b>12.1</b> Formal Statement</a></li>
<li class="chapter" data-level="12.2" data-path="hawaii-is-similar.html"><a href="hawaii-is-similar.html#Links12"><i class="fa fa-check"></i><b>12.2</b> Links</a></li>
<li class="chapter" data-level="12.3" data-path="hawaii-is-similar.html"><a href="hawaii-is-similar.html#chapter-code-12"><i class="fa fa-check"></i><b>12.3</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="the-philippines-is-similar.html"><a href="the-philippines-is-similar.html"><i class="fa fa-check"></i><b>13</b> The Philippines is similar</a><ul>
<li class="chapter" data-level="13.1" data-path="the-philippines-is-similar.html"><a href="the-philippines-is-similar.html#formal-statement-12"><i class="fa fa-check"></i><b>13.1</b> Formal Statement</a></li>
<li class="chapter" data-level="13.2" data-path="the-philippines-is-similar.html"><a href="the-philippines-is-similar.html#Links13"><i class="fa fa-check"></i><b>13.2</b> Links</a></li>
<li class="chapter" data-level="13.3" data-path="the-philippines-is-similar.html"><a href="the-philippines-is-similar.html#chapter-code-13"><i class="fa fa-check"></i><b>13.3</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="thailand-is-similar.html"><a href="thailand-is-similar.html"><i class="fa fa-check"></i><b>14</b> Thailand is similar</a><ul>
<li class="chapter" data-level="14.1" data-path="thailand-is-similar.html"><a href="thailand-is-similar.html#formal-statement-13"><i class="fa fa-check"></i><b>14.1</b> Formal Statement</a></li>
<li class="chapter" data-level="14.2" data-path="hawaii-is-similar.html"><a href="hawaii-is-similar.html#Links12"><i class="fa fa-check"></i><b>14.2</b> Links</a></li>
<li class="chapter" data-level="14.3" data-path="thailand-is-similar.html"><a href="thailand-is-similar.html#chapter-code-14"><i class="fa fa-check"></i><b>14.3</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="taiwan-is-not-similar.html"><a href="taiwan-is-not-similar.html"><i class="fa fa-check"></i><b>15</b> Taiwan is not similar</a><ul>
<li class="chapter" data-level="15.1" data-path="taiwan-is-not-similar.html"><a href="taiwan-is-not-similar.html#formal-statement-14"><i class="fa fa-check"></i><b>15.1</b> Formal Statement</a></li>
<li class="chapter" data-level="15.2" data-path="taiwan-is-not-similar.html"><a href="taiwan-is-not-similar.html#Links15"><i class="fa fa-check"></i><b>15.2</b> Links</a></li>
<li class="chapter" data-level="15.3" data-path="taiwan-is-not-similar.html"><a href="taiwan-is-not-similar.html#chapter-code-15"><i class="fa fa-check"></i><b>15.3</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="australia-is-similar.html"><a href="australia-is-similar.html"><i class="fa fa-check"></i><b>16</b> Australia is similar</a><ul>
<li class="chapter" data-level="16.1" data-path="australia-is-similar.html"><a href="australia-is-similar.html#formal-statement-15"><i class="fa fa-check"></i><b>16.1</b> Formal Statement</a></li>
<li class="chapter" data-level="16.2" data-path="australia-is-similar.html"><a href="australia-is-similar.html#Links16"><i class="fa fa-check"></i><b>16.2</b> Links</a></li>
<li class="chapter" data-level="16.3" data-path="australia-is-similar.html"><a href="australia-is-similar.html#chapter-code-16"><i class="fa fa-check"></i><b>16.3</b> Chapter Code</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="it-is-gravity.html"><a href="it-is-gravity.html"><i class="fa fa-check"></i><b>17</b> It is gravity</a><ul>
<li class="chapter" data-level="17.1" data-path="it-is-gravity.html"><a href="it-is-gravity.html#gravitational-force-differentials"><i class="fa fa-check"></i><b>17.1</b> Gravitational force differentials</a></li>
<li class="chapter" data-level="17.2" data-path="it-is-gravity.html"><a href="it-is-gravity.html#formal-statement-16"><i class="fa fa-check"></i><b>17.2</b> Formal Statement</a></li>
<li class="chapter" data-level="17.3" data-path="it-is-gravity.html"><a href="it-is-gravity.html#chapter-code-17"><i class="fa fa-check"></i><b>17.3</b> Chapter Code</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://thoughtfulbloke.github.io/eqnz/night_tremors.pdf">pdf version</a></li>
<li><a href="https://thoughtfulbloke.github.io/eqnz/night_tremors.epub">epub version</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Night Tremors: There are more earthquakes at night</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="it-is-not-uniform" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> It is not uniform</h1>
<p>The question “Is this a general effect” is closely related to the question “Why has no-one noticed this before, and been convinced enough to push the matter”. If it is a general effect, then you should observe a similar response in all subareas of a region. If the effect is regional, then local geological conditions are going to condition the response.</p>
<p>Using the gridded regions and with either of these assumptions being true:</p>
<ul>
<li>if the the region is not sensitive to a night/day effect</li>
<li>or the sensitivity is confined only to that region</li>
</ul>
<p>then a high proportion of night earthquakes in one region should not influence the number of night earthquakes in neighbouring regions. If the number of night earthquakes is both sensitive to local geological conditions, and those conditions extend beyond the 50 kilometre grid areas, then similar levels of night proportion earthquakes should be found in adjacent grids. This is a test of both the effect itself not being the result of chance, and the distribution of the effects results not being the result of chance</p>
<p>For the purposes of this question, I can rank the proportion of night earthquakes into ten steps (deciles) from highest to lowest. I define similar as a grid square being within one decile step of its neighbour, and I define neighbour as being the grid square to the north or east of the grid square in question. This is to stop double counting with the square to the south of a northern square being the same neighbour as the square to the north of the southern square.</p>
<p><img src="008_not_uniform_files/figure-html/unnamed-chunk-2-1.png" width="600" /></p>
<p>I also limit the grids used to those with more than 80 total earthquake events, so that the sample is large enough the proportion is likely to be a true reflection of the region. In reality, the threshold of 80 is a somewhat arbitrary one that balances having a good number of earthquakes with a good number of grid areas.</p>
<p>The current state is:</p>
<p><img src="008_not_uniform_files/figure-html/unnamed-chunk-4-1.png" width="900" /></p>
<p>Only the very lowest decile contains any grid areas with less than 50% of the earthquakes at night. By eye there seems to be a lot of clustering, but the trick is to measure how unlikely that is.</p>
<p>Using the idea of similar neighbours being one decile apart or the same, 83 (45.86%) of the 181 neighbour pairs are similar.</p>
<p>To determine how likely this is to have occurred, I made a test by simulation. Taking the idea that there are 119 decile values that form the 181 pairs, I repeatedly randomly shuffle the locations of the deciles. This is done on the assumption of independence- that if the areas are unrelated and it is a random process, then the deciles are equally likely to be in any of the locations. Then for each shuffle result I count up how many neighbour pairs are similar. By comparing the 83 observed values with how often that value or more comes up in the simulation, I find out how unlikely the result would be to occur by chance.</p>
<p>As a code writing efficiency note, to be able to do a lot of simulations (100,000,000) quickly (less than 15 minutes), I work out the specific combinations of neighbours ahead of time and provide that, as the combinations are not going to change between simulations.</p>
<p>In the 100,000,000 replications of the simulation, the simulation produced a result as high as the observed one 13 times. As the considering it as a two-sided test, where a extreme result in either direction from the mean is unusual (in this case a freakishly low score would also indicate unnatural arrangement of deciles), the result is 13 in 100,000,000 (as there were 0 that low). Without reading to much into the finer details of this, it does suggest that the observed result is very, extremely unlikely to occur by chance, being outside of 5 sigma.</p>
<div id="formal-statement-7" class="section level2">
<h2><span class="header-section-number">8.1</span> Formal Statement</h2>
<p>As the geographic clustering of night earthquake is not due to chance, we must conclude that not only is there an effect, that effect is influenced by local geological conditions. Those earthquakes influenced by the sun’s position should thus be seen as a local geological response to solar gravity conditions.</p>
</div>
<div id="chapter-code-8" class="section level2">
<h2><span class="header-section-number">8.2</span> Chapter Code</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## ----setup, include=FALSE------------------------------------------------
knitr::opts_chunk$<span class="kw">set</span>(<span class="dt">echo =</span> <span class="ot">FALSE</span>)
knitr::opts_chunk$<span class="kw">set</span>(<span class="dt">warnings=</span><span class="ot">FALSE</span>)
knitr::opts_chunk$<span class="kw">set</span>(<span class="dt">errors=</span><span class="ot">FALSE</span>)
knitr::opts_chunk$<span class="kw">set</span>(<span class="dt">message=</span><span class="ot">FALSE</span>)
knitr::opts_chunk$<span class="kw">set</span>(<span class="dt">dpi =</span> <span class="dv">150</span>)
knitr::opts_chunk$<span class="kw">set</span>(<span class="dt">fig.width =</span>  <span class="dv">6</span>)
knitr::opts_chunk$<span class="kw">set</span>(<span class="dt">fig.height =</span>  <span class="dv">4</span>)

## ------------------------------------------------------------------------
<span class="kw">Sys.setenv</span>(<span class="dt">TZ =</span> <span class="st">&quot;UTC&quot;</span>) 
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(lubridate)
<span class="kw">library</span>(maptools)
<span class="kw">library</span>(binom)
<span class="kw">library</span>(parallel)
<span class="kw">library</span>(plotrix)
<span class="kw">library</span>(solidearthtide)
<span class="kw">library</span>(tidyr)
<span class="kw">library</span>(maps)
<span class="kw">library</span>(mapdata)
<span class="co"># Assumes there is eqnz_processed data created in chapter 2</span>
<span class="kw">load</span>(<span class="st">&quot;eqdata/eqnz_processed.RData&quot;</span>)
old_par &lt;-<span class="st"> </span><span class="kw">par</span>()

lbls &lt;-<span class="st"> </span><span class="kw">c</span>(
 <span class="st">&quot;1 sigma&quot;</span>, <span class="st">&quot;2 sigma&quot;</span>,
 <span class="st">&quot;3 sigma&quot;</span>, <span class="st">&quot;4 sigma&quot;</span>,
 <span class="st">&quot;5 sigma&quot;</span>, <span class="st">&quot;6 sigma&quot;</span>,
 <span class="st">&quot;7 sigma&quot;</span>)
typs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)
weights &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>)
clrs &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">c</span>(<span class="st">&#39;#ffffcc&#39;</span>,<span class="st">&#39;#d9f0a3&#39;</span>,<span class="st">&#39;#addd8e&#39;</span>,<span class="st">&#39;#78c679&#39;</span>,<span class="st">&#39;#41ab5d&#39;</span>,<span class="st">&#39;#238443&#39;</span>,<span class="st">&#39;#005a32&#39;</span>))



## ---- fig.height=4, fig.width=4------------------------------------------
<span class="kw">plot</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="dt">y=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="dt">axes=</span><span class="ot">FALSE</span>, <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;&quot;</span>, <span class="dt">type=</span><span class="st">&quot;n&quot;</span>)
<span class="kw">abline</span>(<span class="dt">h=</span><span class="dv">1</span>)
<span class="kw">abline</span>(<span class="dt">h=</span><span class="dv">2</span>)
<span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">1</span>)
<span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">2</span>)
<span class="kw">text</span>(<span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="st">&quot;region&quot;</span>, <span class="dt">cex=</span><span class="fl">0.8</span>)
<span class="kw">text</span>(<span class="fl">2.5</span>,<span class="fl">1.5</span>,<span class="st">&quot;neighbour&quot;</span>, <span class="dt">cex=</span><span class="fl">0.8</span>)
<span class="kw">text</span>(<span class="fl">1.5</span>,<span class="fl">2.5</span>,<span class="st">&quot;neighbour&quot;</span>, <span class="dt">cex=</span><span class="fl">0.8</span>)

## ------------------------------------------------------------------------
reg_eq &lt;-<span class="st"> </span>eqnz %&gt;%<span class="st"> </span><span class="kw">group_by</span>(eq_roundedlat, eq_roundedlong,
                            eq_gridpoint_y, eq_gridpoint_x) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">region_tot =</span> <span class="kw">n</span>(), <span class="dt">night_prop =</span> <span class="kw">sum</span>(eq_is_night) /<span class="st"> </span>region_tot) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(region_tot &gt;<span class="st"> </span><span class="dv">80</span>) %&gt;%<span class="st"> </span><span class="kw">ungroup</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">decile =</span> <span class="kw">ntile</span>(night_prop, <span class="dv">10</span>)) 
ten_colours &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">c</span>(<span class="st">&#39;#a50026&#39;</span>,<span class="st">&#39;#d73027&#39;</span>,<span class="st">&#39;#f46d43&#39;</span>,<span class="st">&#39;#fdae61&#39;</span>,<span class="st">&#39;#fee090&#39;</span>,
                 <span class="st">&#39;#e0f3f8&#39;</span>,<span class="st">&#39;#abd9e9&#39;</span>,<span class="st">&#39;#74add1&#39;</span>,<span class="st">&#39;#4575b4&#39;</span>,<span class="st">&#39;#313695&#39;</span>))
with_alpha &lt;-<span class="st"> </span><span class="kw">paste</span>(ten_colours, <span class="st">&quot;CC&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
grid_min &lt;-<span class="st"> </span>reg_eq %&gt;%<span class="st"> </span><span class="kw">group_by</span>(decile) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">from=</span> <span class="kw">min</span>(night_prop))


## ------------------------------------------------------------------------
<span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">ncol=</span><span class="dv">4</span>))
<span class="kw">map</span>(<span class="st">&quot;nzHires&quot;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(-<span class="fl">48.5</span>, -<span class="fl">33.5</span>))
<span class="kw">points</span>(reg_eq$eq_roundedlong, reg_eq$eq_roundedlat, <span class="dt">pch=</span><span class="dv">15</span>, <span class="dt">col=</span>with_alpha[reg_eq$decile], <span class="dt">cex=</span><span class="fl">1.5</span>)

<span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))
<span class="kw">plot</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="dt">y=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="dt">type=</span><span class="st">&quot;n&quot;</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>, <span class="dt">axes=</span><span class="ot">FALSE</span>)
<span class="kw">legend</span>(<span class="dv">0</span>,<span class="dv">9</span>, <span class="dt">legend=</span><span class="kw">paste</span>(<span class="dv">1</span>:<span class="dv">10</span>, <span class="st">&quot;: &quot;</span>,<span class="kw">round</span>(grid_min$from,<span class="dv">2</span>), <span class="st">&quot;+&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>) , <span class="dt">fill=</span>with_alpha, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>, <span class="dt">xjust=</span><span class="dv">0</span>,
       <span class="dt">title=</span><span class="st">&quot;Deciles:&quot;</span>, <span class="dt">cex=</span><span class="fl">0.9</span>, <span class="dt">border=</span>with_alpha)




<span class="kw">par</span>(<span class="dt">mar=</span>old_par$mar)
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))



## ------------------------------------------------------------------------
xgrids &lt;-<span class="st"> </span><span class="kw">min</span>(eqnz$eq_gridpoint_x):<span class="kw">max</span>(eqnz$eq_gridpoint_x)
ygrids &lt;-<span class="st"> </span><span class="kw">min</span>(eqnz$eq_gridpoint_y):<span class="kw">max</span>(eqnz$eq_gridpoint_y)
squares &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">xg =</span> <span class="kw">rep</span>(xgrids, <span class="dt">times=</span><span class="kw">length</span>(ygrids)),
                      <span class="dt">yg =</span> <span class="kw">rep</span>(ygrids, <span class="dt">each=</span><span class="kw">length</span>(xgrids)))
squares$east_x &lt;-<span class="st"> </span>squares$xg +<span class="st"> </span><span class="dv">1</span>
squares$north_y &lt;-<span class="st"> </span>squares$yg +<span class="st"> </span><span class="dv">1</span>
gridx &lt;-<span class="st"> </span><span class="kw">c</span>(squares$xg, squares$xg)
gridy &lt;-<span class="st"> </span><span class="kw">c</span>(squares$yg, squares$yg)
neighbourx &lt;-<span class="st"> </span><span class="kw">c</span>(squares$east_x,squares$xg)
neighboury &lt;-<span class="st"> </span><span class="kw">c</span>(squares$yg,squares$north_y)
potential_neighbours &lt;-<span class="st"> </span><span class="kw">data.frame</span>(gridx, gridy, neighbourx, neighboury)
reg_eq$grid_index &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="kw">nrow</span>(reg_eq)
actual_grid &lt;-<span class="st"> </span><span class="kw">merge</span>(potential_neighbours,
                     reg_eq[,<span class="kw">c</span>(<span class="st">&quot;eq_gridpoint_x&quot;</span>, <span class="st">&quot;eq_gridpoint_y&quot;</span>, <span class="st">&quot;grid_index&quot;</span>, <span class="st">&quot;decile&quot;</span>)],
                     <span class="dt">by.x=</span> <span class="kw">c</span>(<span class="st">&quot;gridx&quot;</span>,<span class="st">&quot;gridy&quot;</span>),
                     <span class="dt">by.y=</span> <span class="kw">c</span>(<span class="st">&quot;eq_gridpoint_x&quot;</span>, <span class="st">&quot;eq_gridpoint_y&quot;</span>))
actual_neighbours &lt;-<span class="st"> </span><span class="kw">merge</span>(actual_grid,
                           reg_eq[,<span class="kw">c</span>(<span class="st">&quot;eq_gridpoint_x&quot;</span>, <span class="st">&quot;eq_gridpoint_y&quot;</span>, <span class="st">&quot;grid_index&quot;</span>, <span class="st">&quot;decile&quot;</span>)],
                     <span class="dt">by.x=</span> <span class="kw">c</span>(<span class="st">&quot;neighbourx&quot;</span>,<span class="st">&quot;neighboury&quot;</span>),
                     <span class="dt">by.y=</span> <span class="kw">c</span>(<span class="st">&quot;eq_gridpoint_x&quot;</span>, <span class="st">&quot;eq_gridpoint_y&quot;</span>))
<span class="kw">names</span>(actual_neighbours) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;neighbourx&quot;</span>, <span class="st">&quot;neighboury&quot;</span>, <span class="st">&quot;gridx&quot;</span>,
                              <span class="st">&quot;gridy&quot;</span>, <span class="st">&quot;grid_index&quot;</span>, <span class="st">&quot;decile_grid&quot;</span>, <span class="st">&quot;neighbour_index&quot;</span>, <span class="st">&quot;decile_neighbour&quot;</span>)

grids &lt;-<span class="st"> </span>actual_neighbours$grid_index
neighbours &lt;-<span class="st"> </span>actual_neighbours$neighbour_index
deciles &lt;-<span class="st"> </span>reg_eq$decile

similar &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">abs</span>(actual_neighbours$decile_grid -<span class="st"> </span>actual_neighbours$decile_neighbour) &lt;<span class="st"> </span><span class="dv">2</span>)


## ------------------------------------------------------------------------

if(!<span class="kw">file.exists</span>(<span class="st">&quot;eqdata/simResult.RData&quot;</span>)){
  
  repli &lt;-<span class="st"> </span>function(decs, grids, neighbours){
    decile &lt;-<span class="st"> </span><span class="kw">sample</span>(decs, <span class="dt">size=</span><span class="kw">length</span>(decs), <span class="dt">replace=</span><span class="ot">FALSE</span>)
    grid_dec &lt;-<span class="st"> </span>decile[grids]
    neighbour_dec &lt;-<span class="st"> </span>decile[neighbours]
    <span class="kw">sum</span>(<span class="kw">abs</span>(grid_dec -<span class="st"> </span>neighbour_dec) &lt;<span class="st"> </span><span class="dv">2</span>)
  }
  
  
  replication_size &lt;-<span class="st"> </span><span class="dv">100000000</span>
  <span class="co"># can comfortably get up to 100000000 in one go (15 minutes) on 8 GB machine</span>
  <span class="co"># if run in parrallel on 7 cores</span>
  <span class="co"># but another order of magnitude crashes things</span>
  
  <span class="co"># Calculate the number of cores</span>
  no_cores &lt;-<span class="st"> </span><span class="kw">detectCores</span>() -<span class="st"> </span><span class="dv">1</span>
  
  <span class="co"># Initiate cluster</span>
  cl &lt;-<span class="st"> </span><span class="kw">makeCluster</span>(no_cores)
  <span class="co"># make R objects available to cluster</span>
  <span class="kw">clusterExport</span>(cl, <span class="dt">varlist=</span><span class="kw">c</span>(<span class="st">&quot;repli&quot;</span>, <span class="st">&quot;deciles&quot;</span>, <span class="st">&quot;grids&quot;</span>, <span class="st">&quot;neighbours&quot;</span>))
  <span class="co"># do function in parallel</span>
  similar_rep &lt;-<span class="st"> </span><span class="kw">parSapply</span>(cl, <span class="dv">1</span>:replication_size, 
                           function(x){<span class="kw">repli</span>(deciles, grids, neighbours)})
  <span class="kw">stopCluster</span>(cl)
  <span class="kw">save</span>(similar_rep, <span class="dt">file=</span><span class="st">&quot;eqdata/simResult.RData&quot;</span>)
}

<span class="kw">load</span>(<span class="st">&quot;eqdata/simResult.RData&quot;</span>)

sim_result &lt;-<span class="st"> </span><span class="kw">sum</span>(similar_rep &gt;=<span class="st"> </span>similar)
sim_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(similar_rep)
low_end &lt;-<span class="st"> </span>sim_mean -<span class="st"> </span>(similar -<span class="st"> </span>sim_mean)
sim_extreme &lt;-<span class="st"> </span><span class="kw">sum</span>(similar_rep &gt;=<span class="st"> </span>similar |<span class="st"> </span>similar_rep &lt;=<span class="st"> </span>low_end)</code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="it-is-not-the-moon.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="japanese-earthquakes-are-the-same.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
